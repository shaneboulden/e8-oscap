# e8-oscap

This repo contains files required to perform OpenSCAP scans and remediation against Red Hat Enterprise Linux systems using the Australian Cyber Security Centre [Essential Eight in Linux Environments.](https://www.cyber.gov.au/publications/essential-eight-in-linux-environments) general hardening guidance.

Specifically, these scans and remediations are designed to "optimise the common case". It is designed to meet general audit and system hardening purposes across a broad range of workloads, without getting in the way too much.

## tailoring file

This repo contains a tailoring file, `ssg-rhel7-e8-tailoring-file.xml`, derived from the 'Standard System Security' profile. You can use the SCAP Workbench to customize the file:

- `dnf install scap-workbench`
- Choose `RHEL 7` from the `content to load` menu
- Under `Customization` select `Select Customization File...`
- Select the file `ssg-rhel7-e8-tailoring-file.xml` from this repo

**Important** Note that this tailoring file is built from the /usr/share/xml/scap/ssg/content/ssg-rhel7-xccdf.xml file, shipped with the `scap-security-guide` package with RHEL7. This tailoring file is specifically based on `scap-security-guide-0.1.40-13.el7_6.noarch`

Differences exist between the RHEL7 content available with this package, and the `scap-security-guide-0.1.44-1.fc30.noarch` package currently available from Fedora.

## scanning hosts

You can perform an OpenSCAP scan using the supplied `scan.yml` playbook. The playbook:

- Pushes the tailoring file to the target host;
- Performs an `oscap` scan of the target host, and creates a HTML report
- Pulls the report and XCCDF results back to the bastion host, and names it with the hostname

By default the `scan.yml` playbook will copy the HTML report back to the `/tmp` directory on the bastion host.

The playbook runs against all hosts provided in an inventory. For example:
```
ansible-playbook -i all-hosts scan.yml
```
Or, to run against a particular host:
```
ansible-playbook -i "192.168.122.10," -u user --ask-become-pass scan.yml
```
## remediating hosts

This repo also contains a playbook to remediate hosts against this profile. The playbook runs against all hosts provided in an inventory. For example:
```
ansible-playbook -i all-hosts remediate.yml
```
Or, to run against a particular host:
```
ansible-playbook -i "192.168.122.10," -u user --ask-become-pass remediate.yml
```

## known issues

* The Ansible and Bash remediations generated by `oscap` do not remediate all scan issues detected on a host. The `remediate.yml` playbook currently carries a number of fixes to SSH and audit configuration to ensure that a host will pass an OpenSCAP scan using the tailoring file.

* Hosts may still fail the check `xccdf_org.ssgproject.content_rule_security_patches_up_to_date`, even if `yum update` reports no packages available to update. A method of determining which packages are causing the check to fail can be found here: https://access.redhat.com/solutions/3899241
