# scap-e8

This repo contains files required to perform SCAP scans and remediation against Red Hat Enterprise Linux systems using the Australian Cyber Security Centre [Essential Eight in Linux Environments.](https://www.cyber.gov.au/publications/essential-eight-in-linux-environments)

## tailoring file

This repo contains a tailoring file, `ssg-rhel7-e8-tailoring-file.xml`, derived from the 'Standard System Security' profile. You can use the SCAP Workbench to customize the file:

- `dnf install scap-workbench`
- Choose `RHEL 7` from the `content to load` menu
- Under `Customization` select `Select Customization File...`
- Select the file `ssg-rhel7-e8-tailoring-file.xml` from this repo

## requirements

This scan/remediation requires that the host has `/tmp` and `/dev/shm` configured in `/etc/fstab`. You can easily configure tmpfs volumes by adding the following to `/etc/fstab`:
```
tmpfs /dev/shm tmpfs rw,nosuid,nodev,noexec,seclabel 0 0
tmpfs /tmp tmpfs defaults,noatime,nosuid,nodev,noexec,mode=1777,size=512M 0 0
```

## scanning hosts

You can perform an OpenSCAP scan using the supplied `scan.yml` playbook. The playbook:

- Checks the bastion/localhost has the `scap-security-guide` package installed
- Pushes the tailoring file and data-stream to the target host;
- Performs an `oscap` scan of the target host, and creates a HTML report
- Pulls the report back to the bastion host, and names it with the hostname

By default the `scan.yml` playbook will copy the HTML report back to the `/tmp` directory on the bastion host.

The playbook runs against all hosts provided in an inventory. For example:
```
ansible-playbook -i all-hosts scan.yml
```
Or, to run against a particular host:
```
ansible-playbook -i "192.168.122.10" scan.yml
```
## remediating hosts

This repo also contains a playbook to remediate hosts against this profile. The playbook runs against all hosts provided in an inventory. For example:
```
ansible-playbook -i all-hosts remediate.yml
```
Or, to run against a particular host:
```
ansible-playbook -i "192.168.122.10" remediate.yml
```

## known issues

- The OpenSCAP scan will fail if the host does not have `/tmp` and `/dev/shm` present in `/etc/fstab` (see 
- Presently the role generated by the `oscap` utility fails to remediate several checks specified in the compliance profile. There are currently work-arounds provided in the `remediate.yml` playbook for these three issues:
  * Set sshd LogLeve to INFO
  * Use strong ciphers (sshd)
  * Use strong MACs (sshd)
- Currently the scan doesn't pass the check `Ensure Software Patches Installed` or `Ensure auditd Collects Information on use of Privileged Commands`. This is being investigated.
